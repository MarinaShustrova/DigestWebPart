{"version":3,"sources":["webparts/newsDigest/components/NewsDigest.tsx"],"names":[],"mappings":"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","file":"webparts/newsDigest/components/NewsDigest.js","sourcesContent":["import * as React from 'react';\nimport styles from './NewsDigest.module.scss';\nimport { INewsDigestProps } from './INewsDigestProps';\nimport { INewsDigestState } from './INewsDigestState';\nimport SPServices from './Service/SPServices';\nimport NewsItem from './NewsItem';\n\nexport default class NewsDigest extends React.Component<INewsDigestProps, INewsDigestState> {\n  spService = new SPServices(this.props.context);\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      newsData: new SPServices(this.props.context).getMockData(),\n      isModalOpen: false,\n      selectedNews: [],\n      SPGuid: '',\n      sortByCreated: false,\n    };\n    console.log('props in NewsDigest', props);\n  }\n\n   public toggleSortByCreated = () => {\n    this.setState((prevState) => ({\n      sortByCreated: !prevState.sortByCreated,\n    }));\n  };\n\n  public async componentDidMount() {\n    // Вызовите метод getInfo, чтобы получить новости из SharePoint\n    const allNewsData = await this.spService.getInfo('ваш_сайт_sharepoint');\n\n    // Функция для сравнения дат в порядке возрастания\n    const compareDatesAsc = (a, b) => {\n      const dateA: Date | null = a.Created ? new Date(a.Created) : null;\n      const dateB: Date | null = b.Created ? new Date(b.Created) : null;\n\n      if (dateA && dateB) {\n        return dateA.getTime() - dateB.getTime();\n      } else if (dateA) {\n        return -1;\n      } else if (dateB) {\n        return 1;\n      } else {\n        return 0;\n      }\n    };\n\n    // Функция для сравнения дат в порядке убывания (обратной сортировки)\n    const compareDatesDesc = (a, b) => {\n      const dateA: Date | null = a.Created ? new Date(a.Created) : null;\n      const dateB: Date | null = b.Created ? new Date(b.Created) : null;\n\n      if (dateA && dateB) {\n        return dateB.getTime() - dateA.getTime();\n      } else if (dateA) {\n        return 1;\n      } else if (dateB) {\n        return -1;\n      } else {\n        return 0;\n      }\n    };\n\n    // Выбирайте соответствующий метод сортировки в зависимости от выбранного порядка\n    const sortMethod = this.props.sortByCreated ? compareDatesDesc : compareDatesAsc;\n\n    // Сортируем новости с использованием выбранного метода\n    allNewsData.sort(sortMethod);\n\n    // Распаковка и обработка полученных данных\n    const expandedNewsData = allNewsData.map((news) => ({\n      Id: news.Id,\n      Title: news.Title,\n      Description: news.Description,\n      BannerImageUrl: news.BannerImageUrl,\n      Created: news.Created,\n      Author: news.Author,\n      Url: news.Url,\n      // Добавьте другие поля, которые вам нужны\n    }));\n\n    // Обновите состояние компонента с распакованными данными\n    this.setState({ newsData: expandedNewsData });\n  }\n\n\n public openModal = () => {\n    this.setState({ isModalOpen: true });\n  };\n\npublic closeModal = () => {\n    this.setState({ isModalOpen: false, selectedNews: [] });\n  };\n\n  public handleCheckboxChange = (newsId) => {\n    const { selectedNews } = this.state;\n    const isSelected = selectedNews.indexOf(newsId) !== -1;\n    if (isSelected) {\n      // Если новость уже выбрана, уберите ее из списка выбранных\n      const updatedSelectedNews = selectedNews.filter((id) => id !== newsId);\n      this.setState({\n        selectedNews: updatedSelectedNews,\n      });\n    } else {\n      // Если новость не выбрана, добавьте ее в список выбранных\n      this.setState({\n        selectedNews: [...selectedNews, newsId],\n      });\n    }\n  };\n\n public  generateHTML = (selectedNews) => {\n    let html = '<html><head><title>Рассылка с новостями</title></head><body>';\n\n    // Добавьте заголовок и стили CSS по вашему усмотрению\n\n    selectedNews.forEach((news) => {\n      html += '<article class=\"news-item\">';\n      html += `<img src=\"${news.BannerImageUrl}\" alt=\"Фото новости\" />`;\n      html += '<div class=\"news-content\">';\n      html += `<h2><a href=\"${news.Url}\">${news.Title}</a></h2>`;\n      html += `<p>${news.Description}</p>`;\n      html += `<p>${news.Created}</p>`;\n      html += `<p>${news.Author}</p>`;\n      html += `<p>${news.Url}</p>`;\n      html += '</div></article>';\n    });\n\n    // Добавьте футер и закройте HTML-документ\n\n    html += '</body></html>';\n    return html;\n  };\n\n  handleSubmit = () => {\n    const { selectedNews } = this.state;\n    if (selectedNews.length === 0) {\n      alert('выберите хотя бы одну новость!');\n      return;\n    }\n\n    const html = this.generateHTML(selectedNews);\n    alert('дайджест успешно сформирован!');\n    console.log('html', html);\n\n    // URL сервера SharePoint, куда будет отправлен HTML-код\n    const sharePointUrl = 'https://ваш_сайт_sharepoint/_api/web/lists/getbytitle(\\'Ваш_список\\')/items';\n\n    // Заголовки для запроса\n    const headers = new Headers({\n      'Accept': 'application/json;odata=verbose',\n      'Content-Type': 'application/json;odata=verbose',\n    });\n\n    // Данные для запроса\n    const data = {\n      '__metadata': { 'type': 'SP.Data.Ваш_тип_спискаItem' }, // Укажите тип вашего элемента списка\n      'HTMLContent': html, // Поле, в котором хранится HTML-код\n      // Другие поля, если необходимо\n    };\n\n    // Опции запроса\n    const options = {\n      method: 'POST',\n      headers: headers,\n      body: JSON.stringify(data),\n      credentials: 'same-origin',\n    };\n\n    // Выполнение POST-запроса\n    fetch(sharePointUrl)\n      .then((response) => response.json())\n      .then((data) => {\n        console.log('HTML-код успешно отправлен на сервер SharePoint', data);\n        // Дополнительные действия после успешной отправки\n      })\n      .catch((error) => {\n        console.error('Ошибка при отправке HTML-кода на сервер SharePoint', error);\n        // Обработка ошибки\n      });\n    this.closeModal();\n  };\n\n  render() {\n    const { isModalOpen, selectedNews, newsData } = this.state;\n    const { description, newsCount } = this.props;\n\n    return (\n      <div className={styles.newsDigest}>\n        <div className={styles.SingleStyle}>\n          <div className={styles.SingleStyleContainer}>\n            {isModalOpen ? (\n              <div className={styles.modal}>\n                <div className={styles['modal-content']}>\n                  <div className={styles.title}>Выберите новости </div>\n                  {newsData.slice(0, newsCount).map((news) => (\n                    <NewsItem\n                      key={news.Id}\n                      news={news}\n                      selectedNews={selectedNews}\n                      onCheckboxChange={this.handleCheckboxChange}\n                      AuthorToggle={this.props.AuthorToggle}\n                      DateToggle={this.props.DateToggle}\n                    />\n                  ))}\n                </div>\n                <div className={styles.buttonContainer}>\n                  <button className={styles['button-submit']} onClick={this.handleSubmit}>\n                    Создать\n                  </button>\n                  <button className={styles['button-exit']} onClick={this.closeModal}>\n                    Закрыть\n                  </button>\n                </div>\n              </div>\n            ) : (\n              <button className={styles['button-modal']} onClick={this.openModal}>\n                Создать рассылку\n              </button>\n            )}\n          </div>\n        </div>\n      </div>\n    );\n  }\n}\n"],"sourceRoot":"..\\..\\..\\..\\src"}